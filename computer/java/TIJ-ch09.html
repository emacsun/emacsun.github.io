<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thinking in Java chapter 9 多态</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="emacsun" />
<link rel="stylesheet" type="text/css" href="../../css/worg.css"  />
<a id="home" href="../../index.html"><img src="../../img/assets/home.png" ></a>
<a id="pdf"  href="./TIJ-ch09.pdf"><img src="../../img/assets/pdf.png"></a>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Thinking in Java chapter 9 多态</h1>
<div id="table-of-contents">
<h2>目录</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5060233">1. 简介</a></li>
<li><a href="#org179f7d2">2. 重访 upcasting</a></li>
<li><a href="#org3f24375">3. 纠结</a>
<ul>
<li><a href="#orge12a537">3.1. 方法调用 <code>binding</code></a></li>
<li><a href="#org1ac13b4">3.2. 正确的行为</a></li>
<li><a href="#org61a895b">3.3. 可扩展性</a></li>
<li><a href="#org60d505c">3.4. <code>private</code> 无法被覆盖</a></li>
<li><a href="#org03e91fc">3.5. 对域的处理</a></li>
<li><a href="#org1cc9478">3.6. 对 <code>static</code> 方法的处理</a></li>
</ul>
</li>
<li><a href="#orgcb04789">4. 构造函数和多态</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5060233" class="outline-2">
<h2 id="org5060233"><span class="section-number-2">1</span> 简介</h2>
<div class="outline-text-2" id="text-1">
<p>

</p>

<p>
继数据抽象（data abstraction）和继承( Inheritance )之后，多态(polymorphism)是 Java 语言支持的又一重要特性。
</p>

<p>
使用多态，可以针对同一个操作输入多种类型的数据。多态指的是同一操作支持多中数据类型。这在动态语言中显得尤为明显，比如 <code>Python</code> 。在 <code>Java</code> 中，我们也碰到过多态的例子，比如对于 <code>+</code> 如果我们 <code>1+2</code> 我们期待输出的结果是 <code>3</code> ，此时， <code>+</code> 的功能是数学里的加法运算，但是对于 <code>'a' + 'bc'</code> 这样的运算，我们希望输出的是 <code>'abc'</code> 也就是字符串的级联。这个小例子体现了 <code>+</code> 的多种形态。
</p>

<p>
多态往往和动态绑定等价。在很多地方 polymorphism 和 dynamic binding , late binding, runtime binding 相提并论。
</p>
</div>
</div>
<div id="outline-container-org179f7d2" class="outline-2">
<h2 id="org179f7d2"><span class="section-number-2">2</span> 重访 upcasting</h2>
<div class="outline-text-2" id="text-2">
<p>

</p>

<p>
我们知道通过继承，一个对象的类型可以是当前类（class），也可以是其父类。把一个对象的类型当作其父类来处理就叫做 upcasting. 但是通过下面的这个例子，我们就会看到 upcasting 会导致一个问题。
</p>

<p>
这是一个关于音乐的例子，由于多个类都要用到 Notes，比如 C 小调之类的专有名词，我们首先建立一个 <code>enum</code>
</p>

<div class="org-src-container">
<pre class="src src-c"><span class="linenr">1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/music/Note.java</span>
<span class="linenr">2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Notes to play on musical instruments.</span>
<span class="linenr">3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music;
<span class="linenr">4: </span>
<span class="linenr">5: </span>public <span style="color: #859900; font-weight: bold;">enum</span> <span style="color: #b58900;">Note</span> <span style="color: #2aa198;">{</span>
<span class="linenr">6: </span>    <span style="color: #268bd2;">MIDDLE_C</span>, <span style="color: #268bd2;">C_SHARP</span>, <span style="color: #268bd2;">B_FLAT</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">Etc.</span>
<span class="linenr">7: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>

<p>
然后， <code>Wind</code> 是一个乐器 <code>Instrument</code> 。 <code>Wind</code> 类就继承自 <code>Instrument</code> 类。
</p>

<p>
<code>Instrument</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/music/Instrument.java</span>
<span class="linenr"> 2: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music;
<span class="linenr"> 3: </span><span style="color: #b58900;">import</span> <span style="color: #859900; font-weight: bold;">static</span> net.mindview.util.Print.*;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #b58900;">class</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 6: </span>  public <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 7: </span>    print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Instrument.play()"</span><span style="color: #268bd2;">)</span>;
<span class="linenr"> 8: </span>  <span style="color: #b58900;">}</span>
<span class="linenr"> 9: </span><span style="color: #2aa198;">}</span>
<span class="linenr">10: </span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
<code>Wind</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: reusing/Wind.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Inheritance &amp; upcasting.</span>
<span class="linenr"> 3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Wind objects are instruments</span>
<span class="linenr"> 7: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">because they have the same interface:</span>
<span class="linenr"> 8: </span>public class Wind <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 9: </span>  public <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">){</span>
<span class="linenr">10: </span>   System.out.println<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Wind.play"</span> + n<span style="color: #268bd2;">)</span>;
<span class="linenr">11: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">12: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
最后是 <code>Music</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/music/Music.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Inheritance &amp; upcasting.</span>
<span class="linenr"> 3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">Music</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 6: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tune</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Instrument</span> <span style="color: #268bd2;">i</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 7: </span>    <span style="color: #586e75;">// </span><span style="color: #586e75;">...</span>
<span class="linenr"> 8: </span>    i.play<span style="color: #268bd2;">(</span>Note.MIDDLE_C<span style="color: #268bd2;">)</span>;
<span class="linenr"> 9: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">10: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">11: </span>    <span style="color: #b58900;">Wind</span> <span style="color: #268bd2;">flute</span> = new Wind<span style="color: #268bd2;">()</span>;
<span class="linenr">12: </span>    tune<span style="color: #268bd2;">(</span>flute<span style="color: #268bd2;">)</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">Upcasting</span>
<span class="linenr">13: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">14: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">15: </span><span style="color: #586e75;">Wind.play() MIDDLE_C</span>
<span class="linenr">16: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
注意， <code>Music</code> 类的 <code>Music.tune</code>  方法接受了一个 <code>Instrument</code> 类型的对象。这说明任何从 <code>Instrument</code> 类继承下来的类的对象都可以送给 <code>Music.tune</code>. 在 <code>Music</code> 的 <code>main</code> 函数中，我们送给 <code>tune</code> 的就是 <code>Wind</code> 类型的对象。这是没有问题的，因为 <code>Wind</code> 类继承自 <code>Instrument</code> 类。在这里，通过给 <code>tune</code> 函数送入 <code>Instrument</code> 类型的对象，而不是 <code>Wind</code> 类型的对象，我们节约了大量的代码量。想象一下，乐器有好多种，也就是从 <code>Instrument</code> 类可以继承下来很多对象。如果我们为每一个乐器都写一个 <code>tune</code> 函数，这将是多么无聊的事情。
</p>

<p>
看如下无聊的代码：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/music/Music2.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Overloading instead of upcasting.</span>
<span class="linenr"> 3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music;
<span class="linenr"> 4: </span><span style="color: #b58900;">import</span> <span style="color: #859900; font-weight: bold;">static</span> net.mindview.util.Print.*;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>class Stringed <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 7: </span>  public <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 8: </span>    print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Stringed.play() "</span> + n<span style="color: #268bd2;">)</span>;
<span class="linenr"> 9: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">10: </span><span style="color: #2aa198;">}</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>class Brass <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr">13: </span>  public <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">14: </span>    print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Brass.play() "</span> + n<span style="color: #268bd2;">)</span>;
<span class="linenr">15: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">16: </span><span style="color: #2aa198;">}</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">Music2</span> <span style="color: #2aa198;">{</span>
<span class="linenr">19: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tune</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Wind</span> <span style="color: #268bd2;">i</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">20: </span>    i.play<span style="color: #268bd2;">(</span>Note.MIDDLE_C<span style="color: #268bd2;">)</span>;
<span class="linenr">21: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">22: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tune</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Stringed</span> <span style="color: #268bd2;">i</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">23: </span>    i.play<span style="color: #268bd2;">(</span>Note.MIDDLE_C<span style="color: #268bd2;">)</span>;
<span class="linenr">24: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">25: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tune</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Brass</span> <span style="color: #268bd2;">i</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">26: </span>    i.play<span style="color: #268bd2;">(</span>Note.MIDDLE_C<span style="color: #268bd2;">)</span>;
<span class="linenr">27: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">28: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">29: </span>    <span style="color: #b58900;">Wind</span> <span style="color: #268bd2;">flute</span> = new Wind<span style="color: #268bd2;">()</span>;
<span class="linenr">30: </span>    <span style="color: #b58900;">Stringed</span> <span style="color: #268bd2;">violin</span> = new Stringed<span style="color: #268bd2;">()</span>;
<span class="linenr">31: </span>    <span style="color: #b58900;">Brass</span> <span style="color: #268bd2;">frenchHorn</span> = new Brass<span style="color: #268bd2;">()</span>;
<span class="linenr">32: </span>    tune<span style="color: #268bd2;">(</span>flute<span style="color: #268bd2;">)</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">No upcasting</span>
<span class="linenr">33: </span>    tune<span style="color: #268bd2;">(</span>violin<span style="color: #268bd2;">)</span>;
<span class="linenr">34: </span>    tune<span style="color: #268bd2;">(</span>frenchHorn<span style="color: #268bd2;">)</span>;
<span class="linenr">35: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">36: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">37: </span><span style="color: #586e75;">Wind.play() MIDDLE_C</span>
<span class="linenr">38: </span><span style="color: #586e75;">Stringed.play() MIDDLE_C</span>
<span class="linenr">39: </span><span style="color: #586e75;">Brass.play() MIDDLE_C</span>
<span class="linenr">40: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
上面的代码可以工作，但是这个代码结构有一个致命的问题：你必须为每一个乐器编写 <code>tune</code> 函数。 那么，如果能够只写一次 <code>tune</code> 方法，且送入的对象是 <code>Instrument</code> 类型，而不是 <code>Instrument</code> 的任一子类，岂不是更好？也就是说，在使用 <code>tune</code> 方法的时候，我们如果忘记 <code>tune</code> 的参数类型岂不是更好？这就是多态带来的福利。
</p>
</div>
</div>
<div id="outline-container-org3f24375" class="outline-2">
<h2 id="org3f24375"><span class="section-number-2">3</span> 纠结</h2>
<div class="outline-text-2" id="text-3">
<p>

</p>

<p>
现在，我们有一个问题， <code>Java</code> 在编译的过程中怎么知道 <code>Instrument</code> 类指向的是 <code>Wind</code> 而不是 <code>Brass</code> 或者 <code>Stringed</code> 类？答案是：编译器不知道。为理解这个问题，我们探讨 <code>binding</code> 的原理。
</p>
</div>

<div id="outline-container-orge12a537" class="outline-3">
<h3 id="orge12a537"><span class="section-number-3">3.1</span> 方法调用 <code>binding</code></h3>
<div class="outline-text-3" id="text-3-1">
<p>
把方法调用和方法本身连接起来的过程叫做 <code>binding</code> 。程序执行之前的 binding 叫做 early binding (可能由编译器和链接器来完成)。 <code>C</code> 语言种的 binding 都是 early binding。但是，我们前面的例子告诉我们 <code>Java</code> 中， <code>binding</code> 的方式有些不一样。因为编译器不知道到底该调用哪个方法。所以 <code>Java</code> 中的 binding 方法是所谓的 late binding .意味着 binding 发生在程序运行时。late binding 也叫做 dynamic binding 或者 runtime binding。
</p>

<p>
Java 中除了 <code>static</code> 和 <code>final</code> 方法外，所有的方法都是 <b>late binding</b> .这意味着，你不需要显示的为某个方法指示用什么 binding 方式。Java 已经帮你安排好了。所有的 <code>private</code> 方法都是 <code>final</code> 类型的。指定一个方法为 <code>final</code> 意味着，你不想这个方法动态绑定。这样做的一个好处是编译器会编译出更高效的代码。但是，你不能因为性能的借口，到处使用 <code>final</code> ,你应该处于设计的原因使用 <code>final</code> ，毕竟使用 <code>final</code> 带来的性能提升没有那么多。
</p>
</div>
</div>

<div id="outline-container-org1ac13b4" class="outline-3">
<h3 id="org1ac13b4"><span class="section-number-3">3.2</span> 正确的行为</h3>
<div class="outline-text-3" id="text-3-2">
<p>
一旦知晓 Java 的动态绑定，我们就可以写出支持多态的漂亮代码。你的代码针对的类型不只是当前类，当前类的父类，父类的父类的对象都可以作为参数。这在 <code>Python</code> 中也有明显的体现（Python 是完全动态的语言）。 我们使用一个经常用到的例子来阐述与 动态绑定相关的概念。
</p>

<div id="org0ecabcc" class="figure">
<p><img src="../../img/computer_TIJ/20170730shape.png" alt="20170730shape.png" width="400" align="center" />
</p>
<p><span class="figure-number">图 1:</span> 动态绑定</p>
</div>

<p>
根据上图：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #b58900;">Shape</span> <span style="color: #268bd2;">s</span> = <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Circle</span><span style="color: #2aa198;">()</span>;
</pre>
</div>
<p>
这个语句生成了 <code>Circle</code> 对象，生成的结果转换成了 <code>Shape</code> 类型。貌似，这是一个错误，毕竟我们把一种类型的对象转换成了另一种类型。但是，这是可以的，因为 <code>Circle</code> 类继承自 <code>Shape</code> . 问题来了，
</p>
<div class="org-src-container">
<pre class="src src-java">s.draw<span style="color: #2aa198;">()</span>;
</pre>
</div>
<p>
调用的是哪个函数？你可能会认为调用的是 <code>Shape</code> 的 <code>draw()</code> 函数，因为 <code>s</code> 被转换成了 <code>Shape</code> 类型。但是，这里调用的是 <code>Circle.draw()</code> . 为甚么？因为多态。
</p>

<p>
接下来，看代码，首先是 <code>Shape</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr">1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/shape/Shape.java</span>
<span class="linenr">2: </span><span style="color: #859900; font-weight: bold;">package</span> polymorphism.<span style="color: #268bd2; font-weight: bold;">shape</span>;
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Shape</span> <span style="color: #2aa198;">{</span>
<span class="linenr">5: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">draw</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{}</span>
<span class="linenr">6: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">erase</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{}</span>
<span class="linenr">7: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
<code>Circle</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr">1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/shape/Circle.java</span>
<span class="linenr">2: </span><span style="color: #859900; font-weight: bold;">package</span> polymorphism.<span style="color: #268bd2; font-weight: bold;">shape</span>;
<span class="linenr">3: </span><span style="color: #859900; font-weight: bold;">import</span> <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #268bd2; font-weight: bold;">net</span>.<span style="color: #268bd2; font-weight: bold;">mindview</span>.<span style="color: #268bd2; font-weight: bold;">util</span>.<span style="color: #268bd2; font-weight: bold;">Print</span>.*;
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Circle</span> <span style="color: #859900; font-weight: bold;">extends</span> <span style="color: #b58900;">Shape</span> <span style="color: #2aa198;">{</span>
<span class="linenr">6: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">draw</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Circle.draw()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">7: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">erase</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Circle.erase()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">8: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
<code>Square</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr">1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/shape/Square.java</span>
<span class="linenr">2: </span><span style="color: #859900; font-weight: bold;">package</span> polymorphism.<span style="color: #268bd2; font-weight: bold;">shape</span>;
<span class="linenr">3: </span><span style="color: #859900; font-weight: bold;">import</span> <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #268bd2; font-weight: bold;">net</span>.<span style="color: #268bd2; font-weight: bold;">mindview</span>.<span style="color: #268bd2; font-weight: bold;">util</span>.<span style="color: #268bd2; font-weight: bold;">Print</span>.*;
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Square</span> <span style="color: #859900; font-weight: bold;">extends</span> <span style="color: #b58900;">Shape</span> <span style="color: #2aa198;">{</span>
<span class="linenr">6: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">draw</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Square.draw()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">7: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">erase</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Square.erase()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">8: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
<code>Triangle</code> 类：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr">1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/shape/Triangle.java</span>
<span class="linenr">2: </span><span style="color: #859900; font-weight: bold;">package</span> polymorphism.<span style="color: #268bd2; font-weight: bold;">shape</span>;
<span class="linenr">3: </span><span style="color: #859900; font-weight: bold;">import</span> <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #268bd2; font-weight: bold;">net</span>.<span style="color: #268bd2; font-weight: bold;">mindview</span>.<span style="color: #268bd2; font-weight: bold;">util</span>.<span style="color: #268bd2; font-weight: bold;">Print</span>.*;
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Triangle</span> <span style="color: #859900; font-weight: bold;">extends</span> <span style="color: #b58900;">Shape</span> <span style="color: #2aa198;">{</span>
<span class="linenr">6: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">draw</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Triangle.draw()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">7: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">erase</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Triangle.erase()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">8: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
随机生成形状类：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/shape/RandomShapeGenerator.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">A "factory" that randomly creates shapes.</span>
<span class="linenr"> 3: </span><span style="color: #859900; font-weight: bold;">package</span> polymorphism.<span style="color: #268bd2; font-weight: bold;">shape</span>;
<span class="linenr"> 4: </span><span style="color: #859900; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">java</span>.<span style="color: #268bd2; font-weight: bold;">util</span>.*;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">RandomShapeGenerator</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 7: </span>  <span style="color: #859900; font-weight: bold;">private</span> <span style="color: #b58900;">Random</span> <span style="color: #268bd2;">rand</span> = <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Random</span><span style="color: #b58900;">(</span><span style="color: #6c71c4;">47</span><span style="color: #b58900;">)</span>;
<span class="linenr"> 8: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #b58900;">Shape</span> <span style="color: #268bd2;">next</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 9: </span>    <span style="color: #859900; font-weight: bold;">switch</span><span style="color: #268bd2;">(</span>rand.nextInt<span style="color: #6c71c4;">(</span><span style="color: #6c71c4;">3</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">{</span>
<span class="linenr">10: </span>      <span style="color: #859900; font-weight: bold;">default</span>:
<span class="linenr">11: </span>      <span style="color: #859900; font-weight: bold;">case</span> <span style="color: #6c71c4;">0</span>: <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Circle</span><span style="color: #6c71c4;">()</span>;
<span class="linenr">12: </span>      <span style="color: #859900; font-weight: bold;">case</span> <span style="color: #6c71c4;">1</span>: <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Square</span><span style="color: #6c71c4;">()</span>;
<span class="linenr">13: </span>      <span style="color: #859900; font-weight: bold;">case</span> <span style="color: #6c71c4;">2</span>: <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Triangle</span><span style="color: #6c71c4;">()</span>;
<span class="linenr">14: </span>    <span style="color: #268bd2;">}</span>
<span class="linenr">15: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">16: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
调用以上代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/Shapes.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Polymorphism in Java.</span>
<span class="linenr"> 3: </span><span style="color: #859900; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">polymorphism</span>.<span style="color: #268bd2; font-weight: bold;">shape</span>.*;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">class</span> <span style="color: #b58900;">Shapes</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 6: </span>  <span style="color: #859900; font-weight: bold;">private</span> <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">RandomShapeGenerator</span> <span style="color: #268bd2;">gen</span> =
<span class="linenr"> 7: </span>    <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">RandomShapeGenerator</span><span style="color: #b58900;">()</span>;
<span class="linenr"> 8: </span>  <span style="color: #859900; font-weight: bold;">public</span> <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> <span style="color: #268bd2;">args</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 9: </span>    <span style="color: #b58900;">Shape</span><span style="color: #268bd2;">[]</span> <span style="color: #268bd2;">s</span> = <span style="color: #859900; font-weight: bold;">new</span> <span style="color: #b58900;">Shape</span><span style="color: #268bd2;">[</span><span style="color: #6c71c4;">9</span><span style="color: #268bd2;">]</span>;
<span class="linenr">10: </span>    <span style="color: #586e75;">// </span><span style="color: #586e75;">Fill up the array with shapes:</span>
<span class="linenr">11: </span>    <span style="color: #859900; font-weight: bold;">for</span><span style="color: #268bd2;">(</span><span style="color: #b58900;">int</span> <span style="color: #268bd2;">i</span> = <span style="color: #6c71c4;">0</span>; i &lt; s.<span style="color: #b58900;">length</span>; i++<span style="color: #268bd2;">)</span>
<span class="linenr">12: </span>      s<span style="color: #268bd2;">[</span>i<span style="color: #268bd2;">]</span> = gen.next<span style="color: #268bd2;">()</span>;
<span class="linenr">13: </span>    <span style="color: #586e75;">// </span><span style="color: #586e75;">Make polymorphic method calls:</span>
<span class="linenr">14: </span>    <span style="color: #859900; font-weight: bold;">for</span><span style="color: #268bd2;">(</span><span style="color: #b58900;">Shape</span> <span style="color: #268bd2;">shp</span> : s<span style="color: #268bd2;">)</span>
<span class="linenr">15: </span>      shp.draw<span style="color: #268bd2;">()</span>;
<span class="linenr">16: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">17: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">18: </span><span style="color: #586e75;">Triangle.draw()</span>
<span class="linenr">19: </span><span style="color: #586e75;">Triangle.draw()</span>
<span class="linenr">20: </span><span style="color: #586e75;">Square.draw()</span>
<span class="linenr">21: </span><span style="color: #586e75;">Triangle.draw()</span>
<span class="linenr">22: </span><span style="color: #586e75;">Square.draw()</span>
<span class="linenr">23: </span><span style="color: #586e75;">Triangle.draw()</span>
<span class="linenr">24: </span><span style="color: #586e75;">Square.draw()</span>
<span class="linenr">25: </span><span style="color: #586e75;">Triangle.draw()</span>
<span class="linenr">26: </span><span style="color: #586e75;">Circle.draw()</span>
<span class="linenr">27: </span><span style="color: #586e75;">*/</span><span style="color: #586e75;">//</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
基类 <code>Shape</code> 构建了所有子类的函数接口：所有的子类都可以被 <code>draw</code> 和 <code>erase</code> 。 <code>RandomShapeGenerator</code> 是一个形状工厂，随机生成形状对象，并保存在 <code>s</code> 中。每一个类对象是 <code>Circle</code> <code>Square</code> 或者 <code>Triangle</code> 中的一个，但是在 <code>return</code> 的时候， <code>upcast</code> 成为 <code>Shape</code> 类对象。因此当调用 <code>next()</code> 时，返回的永远是 <code>Shape</code> 类对象。
</p>

<p>
<code>main()</code> 函数通过调用 <code>RandomShapeGenerator.next()</code> 生成了 9 个 <code>Shape</code> 类对象，保存在 <code>s</code> 中。在这个时候，你知道你有一个 <code>Shape</code> 的数组，但是你不知道，生成的到底时 <code>Circle</code> <code>Square</code> 还是 <code>Triangle</code> 。但是，当你逐个调用 <code>draw()</code> 函数的时候，奇妙的事情发生了， <code>Java</code> 居然可以知道每一个 <code>Shape</code> 该执行哪一个 <code>draw()</code> 这个就是多态。
</p>
</div>
</div>
<div id="outline-container-org61a895b" class="outline-3">
<h3 id="org61a895b"><span class="section-number-3">3.3</span> 可扩展性</h3>
<div class="outline-text-3" id="text-3-3">
<p>

</p>

<p>
现在我们重新考虑上面乐器的例子。如上所述，使用多态技术，我们可以在不改变 <code>tune()</code> 方法的前提下，添加任意多种乐器类型。在一个设计考究的面向对象系统中，许多方法都具有类似 <code>tune()</code> 的模式，这些子类只与基类通信，但是使用的却是各自的 <code>tune()</code> 实现。这种代码就由很强的可扩展性。因为通过继承基类的数据类型，我们可以添加新的功能。最重要的，我们不需要改变基类的实现，我们使用的仅仅是基类的接口，真正的实现在各个子类的方法中。
</p>

<p>
图 <a href="#org7945c74">2</a>是一个扩展的例子。
</p>

<div id="org7945c74" class="figure">
<p><img src="../../img/computer_TIJ/20170805extensibility.png" alt="20170805extensibility.png" width="400" align="center" />
</p>
<p><span class="figure-number">图 2:</span> extensibility</p>
</div>

<p>
所有这些新类都和原来的 <code>tune()</code> 相安无事。即便我们把 <code>tune()</code> 放到一个分离的文件中，并为 <code>Instrument</code> 类上添加新的方法， <code>tune()</code> 依然会工作的很好（我们甚至不用重新编译这个文件）。
</p>

<p>
图 <a href="#org7945c74">2</a> 所示的代码如下：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/music3/Music3.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">An extensible program.</span>
<span class="linenr"> 3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>.music3;
<span class="linenr"> 4: </span><span style="color: #b58900;">import</span> <span style="color: #268bd2;">polymorphism</span>.music.Note;
<span class="linenr"> 5: </span><span style="color: #b58900;">import</span> <span style="color: #859900; font-weight: bold;">static</span> net.mindview.util.Print.*;
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #b58900;">class</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 8: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Instrument.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr"> 9: </span>  <span style="color: #b58900;">String</span> <span style="color: #268bd2;">what</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Instrument"</span>; <span style="color: #b58900;">}</span>
<span class="linenr">10: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">adjust</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Adjusting Instrument"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">11: </span><span style="color: #2aa198;">}</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #b58900;">class</span> Wind <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr">14: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Wind.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">15: </span>  <span style="color: #b58900;">String</span> <span style="color: #268bd2;">what</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Wind"</span>; <span style="color: #b58900;">}</span>
<span class="linenr">16: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">adjust</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Adjusting Wind"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">17: </span><span style="color: #2aa198;">}</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #b58900;">class</span> Percussion <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr">20: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Percussion.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">21: </span>  <span style="color: #b58900;">String</span> <span style="color: #268bd2;">what</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Percussion"</span>; <span style="color: #b58900;">}</span>
<span class="linenr">22: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">adjust</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Adjusting Percussion"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">23: </span><span style="color: #2aa198;">}</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #b58900;">class</span> Stringed <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Instrument</span> <span style="color: #2aa198;">{</span>
<span class="linenr">26: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Stringed.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">27: </span>  <span style="color: #b58900;">String</span> <span style="color: #268bd2;">what</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Stringed"</span>; <span style="color: #b58900;">}</span>
<span class="linenr">28: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">adjust</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Adjusting Stringed"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">29: </span><span style="color: #2aa198;">}</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span><span style="color: #b58900;">class</span> Brass <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Wind</span> <span style="color: #2aa198;">{</span>
<span class="linenr">32: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Brass.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">33: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">adjust</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Adjusting Brass"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">34: </span><span style="color: #2aa198;">}</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span><span style="color: #b58900;">class</span> Woodwind <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Wind</span> <span style="color: #2aa198;">{</span>
<span class="linenr">37: </span>  <span style="color: #b58900;">void</span> <span style="color: #268bd2;">play</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Note</span> <span style="color: #268bd2;">n</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Woodwind.play() "</span> + n<span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">38: </span>  <span style="color: #b58900;">String</span> <span style="color: #268bd2;">what</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Woodwind"</span>; <span style="color: #b58900;">}</span>
<span class="linenr">39: </span><span style="color: #2aa198;">}</span>
<span class="linenr">40: </span>
<span class="linenr">41: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">Music3</span> <span style="color: #2aa198;">{</span>
<span class="linenr">42: </span>  <span style="color: #586e75;">// </span><span style="color: #586e75;">Doesn't care about type, so new types</span>
<span class="linenr">43: </span>  <span style="color: #586e75;">// </span><span style="color: #586e75;">added to the system still work right:</span>
<span class="linenr">44: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tune</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Instrument</span> <span style="color: #268bd2;">i</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">45: </span>    <span style="color: #586e75;">// </span><span style="color: #586e75;">...</span>
<span class="linenr">46: </span>    i.play<span style="color: #268bd2;">(</span>Note.MIDDLE_C<span style="color: #268bd2;">)</span>;
<span class="linenr">47: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">48: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">tuneAll</span><span style="color: #b58900;">(</span><span style="color: #b58900;">Instrument</span><span style="color: #268bd2;">[]</span> e<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">49: </span>    <span style="color: #859900; font-weight: bold;">for</span><span style="color: #268bd2;">(</span><span style="color: #b58900;">Instrument</span> <span style="color: #268bd2;">i</span> : e<span style="color: #268bd2;">)</span>
<span class="linenr">50: </span>      tune<span style="color: #268bd2;">(</span>i<span style="color: #268bd2;">)</span>;
<span class="linenr">51: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">52: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">53: </span>    <span style="color: #586e75;">// </span><span style="color: #586e75;">Upcasting during addition to the array:</span>
<span class="linenr">54: </span>    Instrument<span style="color: #268bd2;">[]</span> orchestra = <span style="color: #268bd2;">{</span>
<span class="linenr">55: </span>      <span style="color: #b58900;">new</span> <span style="color: #268bd2;">Wind</span><span style="color: #6c71c4;">()</span>,
<span class="linenr">56: </span>      <span style="color: #268bd2;">new</span> Percussion<span style="color: #6c71c4;">()</span>,
<span class="linenr">57: </span>      <span style="color: #268bd2;">new</span> Stringed<span style="color: #6c71c4;">()</span>,
<span class="linenr">58: </span>      <span style="color: #268bd2;">new</span> Brass<span style="color: #6c71c4;">()</span>,
<span class="linenr">59: </span>      <span style="color: #268bd2;">new</span> Woodwind<span style="color: #6c71c4;">()</span>
<span class="linenr">60: </span>    <span style="color: #268bd2;">}</span>;
<span class="linenr">61: </span>    tuneAll<span style="color: #268bd2;">(</span>orchestra<span style="color: #268bd2;">)</span>;
<span class="linenr">62: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">63: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">64: </span><span style="color: #586e75;">Wind.play() MIDDLE_C</span>
<span class="linenr">65: </span><span style="color: #586e75;">Percussion.play() MIDDLE_C</span>
<span class="linenr">66: </span><span style="color: #586e75;">Stringed.play() MIDDLE_C</span>
<span class="linenr">67: </span><span style="color: #586e75;">Brass.play() MIDDLE_C</span>
<span class="linenr">68: </span><span style="color: #586e75;">Woodwind.play() MIDDLE_C</span>
<span class="linenr">69: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
在上面的代码中，新添加了 <code>what()</code> ，该函数返回一个描述当前类的字符对象。另一个新添加的方法是 <code>adjust()</code> ，该方法提供了调节每一个乐器的方法。
</p>

<p>
在 <code>main()</code> 函数中，当在 <code>orchestra</code> 数组中放置一组乐器时，这些乐器自动升级为 <code>Instrument</code> 。
</p>

<p>
可以看到 <code>tune()</code> 函数完全忽略了其他代码的变化，依然和整个程序配合的很好。这就是多态带来的福利：只改变那些应该被改变的。
</p>
</div>
</div>
<div id="outline-container-org60d505c" class="outline-3">
<h3 id="org60d505c"><span class="section-number-3">3.4</span> <code>private</code> 无法被覆盖</h3>
<div class="outline-text-3" id="text-3-4">
<p>

</p>

<p>
看下面代码：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/PrivateOverride.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Trying to override a private method.</span>
<span class="linenr"> 3: </span><span style="color: #b58900;">package</span> <span style="color: #268bd2;">polymorphism</span>;
<span class="linenr"> 4: </span><span style="color: #b58900;">import</span> <span style="color: #859900; font-weight: bold;">static</span> net.mindview.util.Print.*;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">PrivateOverride</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 7: </span>  private <span style="color: #b58900;">void</span> <span style="color: #268bd2;">f</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"private f()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr"> 8: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 9: </span>    <span style="color: #b58900;">PrivateOverride</span> <span style="color: #268bd2;">po</span> = new Derived<span style="color: #268bd2;">()</span>;
<span class="linenr">10: </span>    po.f<span style="color: #268bd2;">()</span>;
<span class="linenr">11: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">12: </span><span style="color: #2aa198;">}</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #b58900;">class</span> Derived <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">PrivateOverride</span> <span style="color: #2aa198;">{</span>
<span class="linenr">15: </span>  public <span style="color: #b58900;">void</span> <span style="color: #268bd2;">f</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> print<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"public f()"</span><span style="color: #268bd2;">)</span>; <span style="color: #b58900;">}</span>
<span class="linenr">16: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">17: </span><span style="color: #586e75;">private f()</span>
<span class="linenr">18: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
有可能，你会问：问什么输出不是 <code>public f()</code> ？这是 <code>private</code> 类型函数自带 <code>final</code> 标签，无法被覆盖。所以在 <code>Derived</code> 类中的函数是一个新函数。
</p>
</div>
</div>
<div id="outline-container-org03e91fc" class="outline-3">
<h3 id="org03e91fc"><span class="section-number-3">3.5</span> 对域的处理</h3>
<div class="outline-text-3" id="text-3-5">
<p>

</p>

<p>
一旦你学了多态，就想处处使用多态。但是，只有普通函数支持多态。比如，如果你读取一个子域，这个过程是在编译阶段完成的。看代码：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/FieldAccess.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Direct field access is determined at compile time.</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #b58900;">class</span> <span style="color: #268bd2;">Super</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 5: </span>  public <span style="color: #b58900;">int</span> <span style="color: #268bd2;">field</span> = <span style="color: #6c71c4;">0</span>;
<span class="linenr"> 6: </span>  public <span style="color: #b58900;">int</span> <span style="color: #268bd2;">getField</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> field; <span style="color: #b58900;">}</span>
<span class="linenr"> 7: </span><span style="color: #2aa198;">}</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #b58900;">class</span> Sub <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">Super</span> <span style="color: #2aa198;">{</span>
<span class="linenr">10: </span>  public <span style="color: #b58900;">int</span> <span style="color: #268bd2;">field</span> = <span style="color: #6c71c4;">1</span>;
<span class="linenr">11: </span>  public <span style="color: #b58900;">int</span> <span style="color: #268bd2;">getField</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> field; <span style="color: #b58900;">}</span>
<span class="linenr">12: </span>  public <span style="color: #b58900;">int</span> <span style="color: #268bd2;">getSuperField</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span> <span style="color: #859900; font-weight: bold;">return</span> super.field; <span style="color: #b58900;">}</span>
<span class="linenr">13: </span><span style="color: #2aa198;">}</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">FieldAccess</span> <span style="color: #2aa198;">{</span>
<span class="linenr">16: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">17: </span>    <span style="color: #b58900;">Super</span> <span style="color: #268bd2;">sup</span> = new Sub<span style="color: #268bd2;">()</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">Upcast</span>
<span class="linenr">18: </span>    System.out.println<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"sup.field = "</span> + sup.field +
<span class="linenr">19: </span>      <span style="color: #2aa198;">", sup.getField() = "</span> + sup.getField<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span>;
<span class="linenr">20: </span>    <span style="color: #b58900;">Sub</span> <span style="color: #268bd2;">sub</span> = new Sub<span style="color: #268bd2;">()</span>;
<span class="linenr">21: </span>    System.out.println<span style="color: #268bd2;">(</span><span style="color: #2aa198;">"sub.field = "</span> +
<span class="linenr">22: </span>      sub.field + <span style="color: #2aa198;">", sub.getField() = "</span> +
<span class="linenr">23: </span>      sub.getField<span style="color: #6c71c4;">()</span> +
<span class="linenr">24: </span>      <span style="color: #2aa198;">", sub.getSuperField() = "</span> +
<span class="linenr">25: </span>      sub.getSuperField<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span>;
<span class="linenr">26: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">27: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">28: </span><span style="color: #586e75;">sup.field = 0, sup.getField() = 1</span>
<span class="linenr">29: </span><span style="color: #586e75;">sub.field = 1, sub.getField() = 1, sub.getSuperField() = 0</span>
<span class="linenr">30: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
在上面的例子中，我们发现对于 <code>field</code> 的读取是在编译阶段完成的。但是对于函数 <code>getField</code> 的调用却是多态的。
</p>
</div>
</div>
<div id="outline-container-org1cc9478" class="outline-3">
<h3 id="org1cc9478"><span class="section-number-3">3.6</span> 对 <code>static</code> 方法的处理</h3>
<div class="outline-text-3" id="text-3-6">
<p>

</p>

<p>
如果一个方法是 <code>static</code> 的，那么这个方法不具有多态属性。
</p>

<p>
看代码：
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #586e75;">//</span><span style="color: #586e75;">: polymorphism/StaticPolymorphism.java</span>
<span class="linenr"> 2: </span><span style="color: #586e75;">// </span><span style="color: #586e75;">Static methods are not polymorphic.</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #b58900;">class</span> <span style="color: #268bd2;">StaticSuper</span> <span style="color: #2aa198;">{</span>
<span class="linenr"> 5: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">String</span> <span style="color: #268bd2;">staticGet</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 6: </span>    <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Base staticGet()"</span>;
<span class="linenr"> 7: </span>  <span style="color: #b58900;">}</span>
<span class="linenr"> 8: </span>  public <span style="color: #b58900;">String</span> <span style="color: #268bd2;">dynamicGet</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 9: </span>    <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Base dynamicGet()"</span>;
<span class="linenr">10: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">11: </span><span style="color: #2aa198;">}</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #b58900;">class</span> StaticSub <span style="color: #b58900;">extends</span> <span style="color: #268bd2;">StaticSuper</span> <span style="color: #2aa198;">{</span>
<span class="linenr">14: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">String</span> <span style="color: #268bd2;">staticGet</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span>
<span class="linenr">15: </span>    <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Derived staticGet()"</span>;
<span class="linenr">16: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">17: </span>  public <span style="color: #b58900;">String</span> <span style="color: #268bd2;">dynamicGet</span><span style="color: #b58900;">()</span> <span style="color: #b58900;">{</span>
<span class="linenr">18: </span>    <span style="color: #859900; font-weight: bold;">return</span> <span style="color: #2aa198;">"Derived dynamicGet()"</span>;
<span class="linenr">19: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">20: </span><span style="color: #2aa198;">}</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span>public <span style="color: #b58900;">class</span> <span style="color: #268bd2;">StaticPolymorphism</span> <span style="color: #2aa198;">{</span>
<span class="linenr">23: </span>  public <span style="color: #859900; font-weight: bold;">static</span> <span style="color: #b58900;">void</span> <span style="color: #268bd2;">main</span><span style="color: #b58900;">(</span><span style="color: #b58900;">String</span><span style="color: #268bd2;">[]</span> args<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">24: </span>    <span style="color: #b58900;">StaticSuper</span> <span style="color: #268bd2;">sup</span> = new StaticSub<span style="color: #268bd2;">()</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">Upcast</span>
<span class="linenr">25: </span>    System.out.println<span style="color: #268bd2;">(</span>sup.staticGet<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span>;
<span class="linenr">26: </span>    System.out.println<span style="color: #268bd2;">(</span>sup.dynamicGet<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span>;
<span class="linenr">27: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">28: </span><span style="color: #2aa198;">}</span> <span style="color: #586e75;">/* </span><span style="color: #586e75;">Output:</span>
<span class="linenr">29: </span><span style="color: #586e75;">Base staticGet()</span>
<span class="linenr">30: </span><span style="color: #586e75;">Derived dynamicGet()</span>
<span class="linenr">31: </span><span style="color: #586e75;">*///</span><span style="color: #586e75;">:~</span>
</pre>
</div>
<p>
我们可以看到， <code>static</code> 方法不具有多态属性，具有多态属性的是普通函数。
</p>
</div>
</div>
</div>
<div id="outline-container-orgcb04789" class="outline-2">
<h2 id="orgcb04789"><span class="section-number-2">4</span> 构造函数和多态</h2>
<div class="outline-text-2" id="text-4">
<p>

</p>

<p>
构造函数和其他函数不一样，当构造函数和多态碰撞，其发生的化学反应更是不同。首先，构造函数不具有多态属性，因为构造函数是不带 <code>static</code> 的 <code>static</code> 函数。理解构造函数和多态的结合至关重要，可以帮助我们减少很多不必要的麻烦。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'zclspace';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
</body>
</html>
