<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Matlab与C混合编程API之mxCreateDoubleMatrix</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="zcl.space" />
<meta name="description" content="mxCreateDoubleMatrix创建二维双精度浮点数组"
 />
<meta name="keywords" content="matlab communication simulation C" />
<link rel="stylesheet" type="text/css" href="../../css/worg.css"  />
<a id="home" href="../../index.html"><img src="../../img/assets/home.png" ></a>
<a id="pdf"  href="./matlabmxCreateDoulbeMatrix.pdf"><img src="../../img/assets/pdf.png"></a>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Matlab与C混合编程API之mxCreateDoubleMatrix</h1>
<div id="table-of-contents">
<h2>目录</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6863ccb">1. 引言</a></li>
<li><a href="#org9d2f43d">2. 调用语法</a></li>
<li><a href="#org7748e57">3. 输入输出参数</a></li>
<li><a href="#orge55c1ad">4. 功能描述</a></li>
<li><a href="#org64160e3">5. 一个例子</a></li>
<li><a href="#orgae4739d">6. 另一个例子</a></li>
<li><a href="#orga3db293">7. <code>mxCreateDoubleScalar</code></a></li>
<li><a href="#org7c21148">8. 尾声</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6863ccb" class="outline-2">
<h2 id="org6863ccb"><span class="section-number-2">1</span> 引言</h2>
<div class="outline-text-2" id="text-1">
<p>

</p>

<p>
通过<a href="matlabandc.html">matlab与C混合编程之基本原理</a>, 我们知道:在matlab与C的混合编程中，桥梁函数 <code>mexFunction</code> 发挥着至关重要的作用。在这个桥梁函数中，通过调用matlab提供的API可以很方便的实现matlab和C之间的混合编程。本节介绍一个API，名称为： <code>mxCreateDoubleMatrix</code> 。该API的作用是创建二维的双精度浮点数组。
</p>
</div>
</div>

<div id="outline-container-org9d2f43d" class="outline-2">
<h2 id="org9d2f43d"><span class="section-number-2">2</span> 调用语法</h2>
<div class="outline-text-2" id="text-2">
<p>

</p>

<p>
在C文件中，调用 <code>mxCreateDoubleMatrix</code> 的语法为：
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #268bd2;">#include</span> <span style="color: #2aa198;">"matrix.h"</span>
mxArray *mxCreateDoubleMatrix<span style="color: #2aa198;">(</span><span style="color: #b58900;">mwSize</span> <span style="color: #268bd2;">m</span>, <span style="color: #b58900;">mwSize</span> <span style="color: #268bd2;">n</span>,
  <span style="color: #b58900;">mxComplexity</span> <span style="color: #268bd2;">ComplexFlag</span><span style="color: #2aa198;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7748e57" class="outline-2">
<h2 id="org7748e57"><span class="section-number-2">3</span> 输入输出参数</h2>
<div class="outline-text-2" id="text-3">
<p>

</p>

<p>
输入参数如表<a href="#org2e0dbcd">1</a>所示
</p>
<table id="org2e0dbcd" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">表 1:</span> mxCreateDoubleMatrix输入输出参数表</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">参数</th>
<th scope="col" class="org-left">性质</th>
<th scope="col" class="org-left">描述</th>
<th scope="col" class="org-left">类型</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row" class="org-left"><code>m</code></th>
<td class="org-left">输入</td>
<td class="org-left">矩阵行数</td>
<td class="org-left"><code>mwSize</code></td>
</tr>

<tr>
<th scope="row" class="org-left"><code>n</code></th>
<td class="org-left">输入</td>
<td class="org-left">矩阵列数</td>
<td class="org-left"><code>mwSize</code></td>
</tr>

<tr>
<th scope="row" class="org-left"><code>ComplexFlag</code></th>
<td class="org-left">输入</td>
<td class="org-left">是否包含复数元素</td>
<td class="org-left"><code>ComplexFlag</code></td>
</tr>
</tbody>
</table>

<p>
<code>mwSize</code> 是matlab自己定义的用于表示矩阵大小的类型。在C语言中，使用 <code>int</code> 也可以。但是 <code>mwSize</code> 具有跨平台的特性。默认情况下， <code>mwSize</code> 和 C中的 <code>int</code> 是等价的。 当使用 <code>mex -largeArrayDims</code> 编译选项的时候， <code>mwSize</code> 与C中的 <code>size_t</code> 等价。 <code>mxComplexity</code> 用来指定矩阵中数值元素是否包含虚部（即，元素是否既有实部又有虚部）。 <code>mxComplexity</code> 的值只有两个 <code>mxREAL</code> 和 <code>mxComCOMPLEXITY</code> ，前者表示矩阵中元素有虚部，后者表示矩阵中元素没有虚部。之所以存在这样的类型，是因为matlab向C传送数值矩阵的时候，实部和虚部是分开完成的。
</p>


<p>
如果成功创建矩阵，则该函数的输出（即返回值）是一个指向 <code>mxArray</code> 类型的指针。否则返回NULL.
</p>
</div>
</div>
<div id="outline-container-orge55c1ad" class="outline-2">
<h2 id="orge55c1ad"><span class="section-number-2">4</span> 功能描述</h2>
<div class="outline-text-2" id="text-4">
<p>

</p>

<p>
该函数创建一个 <code>m</code> 行 <code>n</code> 列的矩阵，矩阵中的元素类型依 <code>mxComplexity</code> 的值而定。如果 <code>mxComplexity</code> 的值是 <code>mxREAL</code> 则矩阵中的元素类型全是实数，matlab会分配足够的空间来存放这些实数，并将这些实数初始化为0。如果 <code>mxComplexity</code> 的值是 <code>mxCOMPLEX</code> ，则matlab分配足够的空间来存放这个复数空间（实部地址为 <code>pr</code> ,虚部地址为 <code>pi</code> ），实部和虚部都初始化为0。
</p>

<p>
通过调用 <code>mxDestroyArray</code> 来释放 <code>mxCreateDoubleMatrix</code> 创建的矩阵占用的内存空间。
</p>
</div>
</div>

<div id="outline-container-org64160e3" class="outline-2">
<h2 id="org64160e3"><span class="section-number-2">5</span> 一个例子</h2>
<div class="outline-text-2" id="text-5">
<p>

</p>

<p>
举一个很简单的例子，写一个函数返回一个实数乘以2的值。这个例子很简单，但是包含了matlab到C之间互传数据的过程。
</p>
<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #268bd2;">#include</span> <span style="color: #2aa198;">"mex.h"</span>
<span class="linenr"> 2: </span><span style="color: #b58900;">void</span> <span style="color: #268bd2;">timestwo</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">double</span> <span style="color: #268bd2;">y</span><span style="color: #b58900;">[]</span>, <span style="color: #b58900;">double</span> <span style="color: #268bd2;">x</span><span style="color: #b58900;">[]</span><span style="color: #2aa198;">)</span>
<span class="linenr"> 3: </span><span style="color: #2aa198;">{</span>
<span class="linenr"> 4: </span>  y<span style="color: #b58900;">[</span><span style="color: #6c71c4;">0</span><span style="color: #b58900;">]</span> = <span style="color: #6c71c4;">2.0</span>*x<span style="color: #b58900;">[</span><span style="color: #6c71c4;">0</span><span style="color: #b58900;">]</span>;
<span class="linenr"> 5: </span><span style="color: #2aa198;">}</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #b58900;">void</span> <span style="color: #268bd2;">mexFunction</span><span style="color: #2aa198;">(</span> <span style="color: #b58900;">int</span> <span style="color: #268bd2;">nlhs</span>, <span style="color: #b58900;">mxArray</span> *<span style="color: #268bd2;">plhs</span><span style="color: #b58900;">[]</span>,
<span class="linenr"> 8: </span>      <span style="color: #b58900;">int</span> <span style="color: #268bd2;">nrhs</span>, <span style="color: #859900; font-weight: bold;">const</span> <span style="color: #b58900;">mxArray</span> *<span style="color: #268bd2;">prhs</span><span style="color: #b58900;">[]</span> <span style="color: #2aa198;">)</span>
<span class="linenr"> 9: </span><span style="color: #2aa198;">{</span>
<span class="linenr">10: </span>  <span style="color: #b58900;">double</span> *<span style="color: #268bd2;">x</span>,*<span style="color: #268bd2;">y</span>;
<span class="linenr">11: </span>  <span style="color: #b58900;">size_t</span> <span style="color: #268bd2;">mrows</span>,<span style="color: #268bd2;">ncols</span>;
<span class="linenr">12: </span>
<span class="linenr">13: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">Check for proper number of arguments. </span><span style="color: #586e75;">*/</span>
<span class="linenr">14: </span>  <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span>nrhs!=<span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">15: </span>    mexErrMsgIdAndTxt<span style="color: #268bd2;">(</span> <span style="color: #2aa198;">"MATLAB:timestwo:invalidNumInputs"</span>,
<span class="linenr">16: </span>      <span style="color: #2aa198;">"One input required."</span><span style="color: #268bd2;">)</span>;
<span class="linenr">17: </span>  <span style="color: #b58900;">}</span> <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span>nlhs&gt;<span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">18: </span>    mexErrMsgIdAndTxt<span style="color: #268bd2;">(</span> <span style="color: #2aa198;">"MATLAB:timestwo:maxlhs"</span>,
<span class="linenr">19: </span>      <span style="color: #2aa198;">"Too many output arguments."</span><span style="color: #268bd2;">)</span>;
<span class="linenr">20: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">The input must be a noncomplex scalar double.</span><span style="color: #586e75;">*/</span>
<span class="linenr">23: </span>  mrows = mxGetM<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">24: </span>  ncols = mxGetN<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">25: </span>  <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span> <span style="color: #b58900; font-weight: bold;">!</span>mxIsDouble<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span> || mxIsComplex<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span> ||
<span class="linenr">26: </span>      <span style="color: #b58900; font-weight: bold;">!</span><span style="color: #268bd2;">(</span>mrows==<span style="color: #6c71c4;">1</span> &amp;&amp; ncols==<span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span> <span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">27: </span>    mexErrMsgIdAndTxt<span style="color: #268bd2;">(</span>
<span class="linenr">28: </span>    <span style="color: #2aa198;">"MATLAB:timestwo:inputNotRealScalarDouble"</span>,
<span class="linenr">29: </span>    <span style="color: #2aa198;">"Input must be a noncomplex scalar double."</span><span style="color: #268bd2;">)</span>;
<span class="linenr">30: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">Create matrix for the return argument. </span><span style="color: #586e75;">*/</span>
<span class="linenr">33: </span>  plhs<span style="color: #b58900;">[</span><span style="color: #6c71c4;">0</span><span style="color: #b58900;">]</span> = mxCreateDoubleMatrix<span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span><span style="color: #b58900;">mwSize</span><span style="color: #268bd2;">)</span>mrows,
<span class="linenr">34: </span>         <span style="color: #268bd2;">(</span><span style="color: #b58900;">mwSize</span><span style="color: #268bd2;">)</span>ncols, mxREAL<span style="color: #b58900;">)</span>;
<span class="linenr">35: </span>
<span class="linenr">36: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">Assign pointers to each input and output. </span><span style="color: #586e75;">*/</span>
<span class="linenr">37: </span>  x = mxGetPr<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">38: </span>  y = mxGetPr<span style="color: #b58900;">(</span>plhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">39: </span>
<span class="linenr">40: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">Call the timestwo subroutine. </span><span style="color: #586e75;">*/</span>
<span class="linenr">41: </span>  timestwo<span style="color: #b58900;">(</span>y,x<span style="color: #b58900;">)</span>;
<span class="linenr">42: </span><span style="color: #2aa198;">}</span>
</pre>
</div>

<p>
代码的第2-5行实现了乘以2的功能。代码的第7-42行实现了 <code>mexFunction</code> 。代码的第14-20行用来检查输入数据的格式，这些代码的主要作用是方便调试，暂时不管。代码的第23-24行获得了输入数据的维度，用于为输出数据指定内存空间大小。第33-34行调用了本文介绍的 <code>mxCreateDoubleMatrix</code> API。 并将返回地址赋给 <code>plhs[0]</code> 。
</p>

<p>
第33行至第41行是 <code>mexFunction</code> 的核心。通过 <code>mxCreateDoubleMatrix</code> 申请保存输出的内存空间，并把地址赋给 <code>plhs[0]</code> 这样matlab脚本就可以得到C函数的输出。 通过调用 <code>mxGetPr</code> 函数把 <code>plhs[0]</code> 的值赋给 <code>y</code> ，然后在C函数中为 <code>y</code> 指向的内存单元复制，这里 <code>y</code> 也是指针。 <code>mxGetPr</code> 函数实现了 <code>mxArray</code> 指针向 <code>double</code> 类型指针的转换。
</p>
</div>
</div>
<div id="outline-container-orgae4739d" class="outline-2">
<h2 id="orgae4739d"><span class="section-number-2">6</span> 另一个例子</h2>
<div class="outline-text-2" id="text-6">
<p>

</p>

<p>
再来一个例子，本例完成标量和矩阵相乘的功能。代码如下：
</p>

<div class="org-src-container">
<pre class="src src-c"><span class="linenr"> 1: </span><span style="color: #268bd2;">#include</span> <span style="color: #2aa198;">"mex.h"</span>
<span class="linenr"> 2: </span><span style="color: #b58900;">void</span> <span style="color: #268bd2;">xtimesy</span><span style="color: #2aa198;">(</span><span style="color: #b58900;">double</span> <span style="color: #268bd2;">x</span>, <span style="color: #b58900;">double</span> *<span style="color: #268bd2;">y</span>,
<span class="linenr"> 3: </span>       <span style="color: #b58900;">double</span> *<span style="color: #268bd2;">z</span>, <span style="color: #b58900;">size_t</span> <span style="color: #268bd2;">m</span>, <span style="color: #b58900;">size_t</span> <span style="color: #268bd2;">n</span><span style="color: #2aa198;">)</span>
<span class="linenr"> 4: </span><span style="color: #2aa198;">{</span>
<span class="linenr"> 5: </span>  <span style="color: #b58900;">mwSize</span> <span style="color: #268bd2;">i</span>,<span style="color: #268bd2;">j</span>,<span style="color: #268bd2;">count</span>=<span style="color: #6c71c4;">0</span>;
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>  <span style="color: #859900; font-weight: bold;">for</span> <span style="color: #b58900;">(</span>i=<span style="color: #6c71c4;">0</span>; i&lt;n; i++<span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr"> 8: </span>    <span style="color: #859900; font-weight: bold;">for</span> <span style="color: #268bd2;">(</span>j=<span style="color: #6c71c4;">0</span>; j&lt;m; j++<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">{</span>
<span class="linenr"> 9: </span>      *<span style="color: #6c71c4;">(</span>z+count<span style="color: #6c71c4;">)</span> = x * *<span style="color: #6c71c4;">(</span>y+count<span style="color: #6c71c4;">)</span>;
<span class="linenr">10: </span>      count++;
<span class="linenr">11: </span>    <span style="color: #268bd2;">}</span>
<span class="linenr">12: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">13: </span><span style="color: #2aa198;">}</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #586e75;">/* </span><span style="color: #586e75;">the gateway function </span><span style="color: #586e75;">*/</span>
<span class="linenr">16: </span><span style="color: #b58900;">void</span> <span style="color: #268bd2;">mexFunction</span><span style="color: #2aa198;">(</span> <span style="color: #b58900;">int</span> <span style="color: #268bd2;">nlhs</span>, <span style="color: #b58900;">mxArray</span> *<span style="color: #268bd2;">plhs</span><span style="color: #b58900;">[]</span>,
<span class="linenr">17: </span>      <span style="color: #b58900;">int</span> <span style="color: #268bd2;">nrhs</span>, <span style="color: #859900; font-weight: bold;">const</span> <span style="color: #b58900;">mxArray</span> *<span style="color: #268bd2;">prhs</span><span style="color: #b58900;">[]</span><span style="color: #2aa198;">)</span>
<span class="linenr">18: </span><span style="color: #2aa198;">{</span>
<span class="linenr">19: </span>  <span style="color: #b58900;">double</span> *<span style="color: #268bd2;">y</span>,*<span style="color: #268bd2;">z</span>;
<span class="linenr">20: </span>  <span style="color: #b58900;">double</span>  <span style="color: #268bd2;">x</span>;
<span class="linenr">21: </span>  <span style="color: #b58900;">size_t</span> <span style="color: #268bd2;">mrows</span>,<span style="color: #268bd2;">ncols</span>;
<span class="linenr">22: </span>
<span class="linenr">23: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">check for proper number of arguments </span><span style="color: #586e75;">*/</span>
<span class="linenr">24: </span>  <span style="color: #586e75;">/* </span><span style="color: #d0bf8f;">NOTE</span><span style="color: #586e75;">: You do not need an else statement when</span>
<span class="linenr">25: </span><span style="color: #586e75;">     using mexErrMsgIdAndTxt within an if statement,</span>
<span class="linenr">26: </span><span style="color: #586e75;">     because it will never get to the else statement</span>
<span class="linenr">27: </span><span style="color: #586e75;">     if mexErrMsgIdAndTxt is executed.</span>
<span class="linenr">28: </span><span style="color: #586e75;">     (mexErrMsgIdAndTxt breaks you out of the</span>
<span class="linenr">29: </span><span style="color: #586e75;">    MEX-file) </span><span style="color: #586e75;">*/</span>
<span class="linenr">30: </span>  <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span>nrhs!=<span style="color: #6c71c4;">2</span><span style="color: #b58900;">)</span>
<span class="linenr">31: </span>    mexErrMsgIdAndTxt<span style="color: #b58900;">(</span>
<span class="linenr">32: </span>      <span style="color: #2aa198;">"MATLAB:xtimesy:invalidNumInputs"</span>,
<span class="linenr">33: </span>      <span style="color: #2aa198;">"Two inputs required."</span><span style="color: #b58900;">)</span>;
<span class="linenr">34: </span>  <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span>nlhs!=<span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span>
<span class="linenr">35: </span>    mexErrMsgIdAndTxt<span style="color: #b58900;">(</span>
<span class="linenr">36: </span>      <span style="color: #2aa198;">"MATLAB:xtimesy:invalidNumOutputs"</span>,
<span class="linenr">37: </span>      <span style="color: #2aa198;">"One output required."</span><span style="color: #b58900;">)</span>;
<span class="linenr">38: </span>
<span class="linenr">39: </span>  <span style="color: #586e75;">/* </span><span style="color: #586e75;">check to make sure the first input argument is</span>
<span class="linenr">40: </span><span style="color: #586e75;">     a scalar </span><span style="color: #586e75;">*/</span>
<span class="linenr">41: </span>  <span style="color: #859900; font-weight: bold;">if</span><span style="color: #b58900;">(</span> <span style="color: #b58900; font-weight: bold;">!</span>mxIsDouble<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span> ||
<span class="linenr">42: </span>      mxIsComplex<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span> ||
<span class="linenr">43: </span>      mxGetN<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span>*mxGetM<span style="color: #268bd2;">(</span>prhs<span style="color: #6c71c4;">[</span><span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span>!=<span style="color: #6c71c4;">1</span> <span style="color: #b58900;">)</span> <span style="color: #b58900;">{</span>
<span class="linenr">44: </span>    mexErrMsgIdAndTxt<span style="color: #268bd2;">(</span> <span style="color: #2aa198;">"MATLAB:xtimesy:xNotScalar"</span>,
<span class="linenr">45: </span>      <span style="color: #2aa198;">"Input x must be a scalar."</span><span style="color: #268bd2;">)</span>;
<span class="linenr">46: </span>  <span style="color: #b58900;">}</span>
<span class="linenr">47: </span>
<span class="linenr">48: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">get the scalar input x </span><span style="color: #586e75;">*/</span>
<span class="linenr">49: </span>  x = mxGetScalar<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">50: </span>
<span class="linenr">51: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">create a pointer to the input matrix y </span><span style="color: #586e75;">*/</span>
<span class="linenr">52: </span>  y = mxGetPr<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">1</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">53: </span>
<span class="linenr">54: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">get the dimensions of the matrix input y </span><span style="color: #586e75;">*/</span>
<span class="linenr">55: </span>  mrows = mxGetM<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">1</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">56: </span>  ncols = mxGetN<span style="color: #b58900;">(</span>prhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">1</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">57: </span>
<span class="linenr">58: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">set the output pointer to the output matrix </span><span style="color: #586e75;">*/</span>
<span class="linenr">59: </span>  plhs<span style="color: #b58900;">[</span><span style="color: #6c71c4;">0</span><span style="color: #b58900;">]</span> = mxCreateDoubleMatrix<span style="color: #b58900;">(</span> <span style="color: #268bd2;">(</span><span style="color: #b58900;">mwSize</span><span style="color: #268bd2;">)</span>mrows,
<span class="linenr">60: </span>          <span style="color: #268bd2;">(</span><span style="color: #b58900;">mwSize</span><span style="color: #268bd2;">)</span>ncols, mxREAL<span style="color: #b58900;">)</span>;
<span class="linenr">61: </span>
<span class="linenr">62: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">create a C pointer to a copy of the</span>
<span class="linenr">63: </span><span style="color: #586e75;">      output matrix </span><span style="color: #586e75;">*/</span>
<span class="linenr">64: </span>  z = mxGetPr<span style="color: #b58900;">(</span>plhs<span style="color: #268bd2;">[</span><span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>;
<span class="linenr">65: </span>
<span class="linenr">66: </span>  <span style="color: #586e75;">/*  </span><span style="color: #586e75;">call the C subroutine </span><span style="color: #586e75;">*/</span>
<span class="linenr">67: </span>  xtimesy<span style="color: #b58900;">(</span>x,y,z,mrows,ncols<span style="color: #b58900;">)</span>;
<span class="linenr">68: </span>
<span class="linenr">69: </span><span style="color: #2aa198;">}</span>
</pre>
</div>

<p>
本例的第2-13行完成了标量乘以矩阵的c函数。在桥梁函数中，matlab传入的矩阵 <code>y</code> 体现为指向矩阵 <code>y</code> 的第一个元素的地址。这个通过第52行代码实现。
</p>
<div class="org-src-container">
<pre class="src src-c">y = mxGetPr<span style="color: #2aa198;">(</span>prhs<span style="color: #b58900;">[</span><span style="color: #6c71c4;">1</span><span style="color: #b58900;">]</span><span style="color: #2aa198;">)</span>;
</pre>
</div>

<p>
第55行和第56行代码分别调用 <code>mxGetM</code> 和 <code>mxGetN</code> 获得传入矩阵 <code>y</code> 的行数和列数。第59行调用 <code>mxCreateDoulbeMatrix</code> 为输出分配内存空间，创建了行数为 <code>mrows</code> ,列数为 <code>ncols</code> 的实数矩阵空间。 第64行把这个是数据矩阵空间的地址通过 <code>mxGetPr</code> 赋给 <code>z</code> ，经过第64行， <code>plhs[0]</code> 指向内存单元就和 <code>z</code> 指向的内存单元相同。
</p>

<p>
最后需要注意的一点：在matlab中矩阵的索引是按 <b>列</b> 进行的，比如一个矩阵x=[ 1 2; 3 4]，则用一个索引变量遍历x结果为：x(1) = 1,x(2) = 3,x(3) =2, x(4) =4，也就是说矩阵的第二个元素是3不是2。用两个索引变量为：x(1,1) = 1, x(1,2) =2,x(2,1) =x3,x(2,2)=4。之所以交代这个的原因是在matlab中，传入的是指向矩阵第一个元素的指针，其加1指向的是矩阵的第二个元素，也就是矩阵的第二列第一个元素，不是矩阵的第一行第二列的那个元素。
</p>
</div>
</div>

<div id="outline-container-orga3db293" class="outline-2">
<h2 id="orga3db293"><span class="section-number-2">7</span> <code>mxCreateDoubleScalar</code></h2>
<div class="outline-text-2" id="text-7">
<p>

</p>

<p>
既然介绍了 <code>mxCreateDoulbeMatrix</code>  ，就顺带提一下另一个API <code>mxCreateDoubleScalar</code> 。这个API是 <code>mxCreateDoulbeMatrix</code> 的特殊形式，其创建指向一个double标量的指针，并初始化。其语法为：
</p>
<div class="org-src-container">
<pre class="src src-c">pa = mxCreateDoubleScalar<span style="color: #2aa198;">(</span>value<span style="color: #2aa198;">)</span>;
</pre>
</div>
<p>
pa是个地址指向一个doulbe值，大小为 <code>value</code> 。
</p>

<p>
用 <code>mxCreateDoulbeMatrix</code> 完成就是：
</p>
<div class="org-src-container">
<pre class="src src-c">pa = mxCreateDoubleMatrix<span style="color: #2aa198;">(</span><span style="color: #6c71c4;">1</span>, <span style="color: #6c71c4;">1</span>, mxREAL<span style="color: #2aa198;">)</span>;
*mxGetPr<span style="color: #2aa198;">(</span>pa<span style="color: #2aa198;">)</span> = value;
</pre>
</div>

<p>
显然，在桥梁变量里创建标量的时， <code>mxCreateDoubleScalar</code> 更方便。
</p>
</div>
</div>
<div id="outline-container-org7c21148" class="outline-2">
<h2 id="org7c21148"><span class="section-number-2">8</span> 尾声</h2>
<div class="outline-text-2" id="text-8">
<p>

</p>

<p>
本文通过简单介绍了 <code>mxCreateDoulbeMatrix</code> API，并通过两个例子阐述了其用法，还介绍了其特殊形式 <code>mxCreateDoubleScalar</code> 。 在两个例子中顺带介绍了 <code>mxGetM</code> <code>mxGetN</code> <code>mxGetPr</code> ，关于这后三个简单的API就不另开博文做专门介绍了。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'zclspace';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
</body>
</html>
